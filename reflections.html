<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflections | Student Hub</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">Student<span style="color: var(--accent)">Hub</span></div>
            <div class="nav-links">
                <a href="dashboard.html">Dashboard</a>
                <a href="tasks.html">Tasks</a>
                <a href="study.html">Study</a>
                <a href="reflections.html" class="active">Reflections</a>
                <a href="flashcards.html">Flashcards</a>
            </div>
            <button onclick="Backend.logout()" class="btn"
                style="padding: 0.5rem 1rem; font-size: 0.9rem; background: rgba(255,255,255,0.1);">Logout</button>
        </div>
    </nav>

    <div class="container fade-in">
        <div class="grid" style="grid-template-columns: 1fr 300px; align-items: start;">
            <div>
                <h1>Daily Journal</h1>
                <div class="card">
                    <form onsubmit="saveReflection(event)">
                        <div class="input-group">
                            <label>Reflection</label>
                            <textarea id="refText" rows="6" placeholder="What did you learn today? (Min 10 chars)"
                                required
                                style="width: 100%; border-radius: 8px; background: #020617; border: 1px solid var(--glass-border); color: white; padding: 1rem;"></textarea>
                        </div>
                        <button type="submit" class="btn">Save Entry</button>
                    </form>
                </div>
            </div>

            <div style="margin-top: 0">
                <h3 style="margin-bottom: 1rem;">Past Entries</h3>
                <div id="reflectionList" style="display: flex; flex-direction: column; gap: 1rem;">
                    <p>Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { Backend } from './app.js';

        window.saveReflection = async (e) => {
            e.preventDefault();
            const text = document.getElementById('refText').value;

            try {
                await Backend.createReflection(text);
                document.getElementById('refText').value = '';
                loadReflections();
            } catch (err) {
                alert(err.message);
            }
        };

        async function loadReflections() {
            const list = document.getElementById('reflectionList');
            try {
                const refs = await Backend.getUserReflections();
                list.innerHTML = '';

                // Sort by date desc
                refs.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                if (refs.length === 0) list.innerHTML = '<p style="color:var(--text-muted)">No entries yet.</p>';

                refs.forEach(r => {
                    const el = document.createElement('div');
                    el.className = 'card';
                    el.style.padding = '1rem';
                    el.innerHTML = `
                    <div style="font-size: 0.85rem; color: var(--accent); margin-bottom: 0.5rem;">${new Date(r.createdAt).toLocaleDateString()}</div>
                    <p style="margin: 0; font-size: 0.9rem; color: var(--text-muted); display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                      ${r.text}
                    </p>
                `;
                    list.appendChild(el);
                });

            } catch (e) {
                console.error(e);
            }
        }
        loadReflections();
    </script>
</body>

</html>